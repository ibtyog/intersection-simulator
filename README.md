# Intersection-simulator
Simulation to support decision of choosing intersection with lights or roundabout.

[Kacper K](https://github.com/Drag0neUsz)

[Pawe≈Ç J]()

[Piotr H](https://github.com/ibtyog)

## Technologies used
- Python programming language,
- Simulator of Urban Mobility (SUMO).

## Measures
Main purpose of program is to show the measure of average time of vehicle passing the given scenario (Ticks of time in SUMO are converted to "real-time" seconds). Scenarios' configurations can be built in SUMO GUI editor and need to be exported to <i>XML</i> files.

Other measures are:
- name of scenario,
- iteration of current scenario,
- percentage of trucks,
- <i>tau</i> of cars,
- <i>tau</i> of trucks,
- number of cars involved in scenario,
- total simulation time (time is counted till last tick of simulation)

### Explanation of <i>tau</i>
<i>Tau</i> is parameter of distance, kept between vehicles.

## App modules
### consts.py
This file contains all necessary constats and environmental variables for program to work.
- SUMO_HOME is envvar for path to SUMO binaries, so it can be used by SumoLib,
- SUMO_BINARY - name of folder, containing binaries of SUMO,
- CONFIG_FILES - dictionary dataset for scenarios configuration files,
- NUM_SIMULATIONS - (whole) number of simulations,
- SIM_DURATION - time of generating vehicles for current flow in current simulation,
- RANGE_P_TRUCKS - range, in which percentage of trucks is drawn,
- RANGE_TAU_CAR - range, in which <i>Tau</i> of cars is drawn,
- MIN_TAU_TRUCK_OFFSET - offset of variable above, to get <i>Tau</i> of trucks,
- SUMMARY_OUTPUT_FILE - path of file generated, after SUMO simulation.
- CSV_HEADERS - array of fixed headers' names for parser,
- ORIGINAL_FLOWS - dictionary dataset of original flows, used for generating flows for alternative scenarios.
### routes.py
This file is used to generate flows for given scenario, based on ORIGINAL_FLOWS. The inputs are:
- filename - path, where generated routes should be exported,
- p_trucks - percentage of trucks in simulation,
- tau_trucks - explained in consts.py section,
- tau_cars - explained in consts.py section,

Returns path to generated flow file.

### simulation.py
This file is used to ran singular simulation in headless mode. Inputs are:
- config_file - configuration file of scenario,
- routes_file - routes file, generated in routes.py.

There is available option of forcing ending of simulation, by default simulation lasts till all vehicles leave scenario.

Function returns True if simulation ended successfully, otherwise it returns None.

### parser.py
This file is used to parse XML results generated by SUMO. XML file path should be provided as input.

## Explanation of main.py 
This file is used to execute whole simulations cycle. Only variable used is:
- OUTPUT_CSV - path of parsed results.

### Flow of main.py
1. Creating results file and appending <i>CSV_HEADERS</i>,
2. Simulation loop:

    a. draw ratio of trucks from given range,

    b. draw <i>Tau</i> values,

    c. generating routes file for current iteration,

    d. check, if singular simulation ended successfully,

    e. parsing values from XML file,

    f. appending results to <i>OUTPUT_CSV</i> file.

3. Inform about ending simulation cycle.

As addtion program esteminates time left based on last 20 simulation times.